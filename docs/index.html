<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Pairin Lite｜ワイン・マッチング（フェス用）</title>
  <meta name="description" content="10問の2択にスワイプで答えると、あなたに合うワインタイプとおすすめ銘柄を提案します。YORUGOS フェス／試飲ブース用。" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Playfair+Display:wght@600&display=swap" rel="stylesheet">
  <!-- Hammer.js for swipe -->
  <script src="https://cdn.jsdelivr.net/npm/hammerjs@2.0.8/hammer.min.js"></script>
  <style>
    :root{
      --bg:#fff8f1;--card:#ffffff;--ink:#101114;--muted:#6d717b;--line:#e7e8ee;
      --ok:#0f9d58;--warn:#f4b400;--rose:#e91e63;--sky:#1a73e8;--brand:#7c3aed;
      --radius:18px;--shadow:0 10px 30px rgba(0,0,0,.10);
      /* Type theme colors */
      --BOLD:#c01b53;--FRESH:#00a39a;--AROMA:#8b5cf6;--SWEET:#ff7aa2;--SPARK:#00a8ff;

      /* Swipe feedback */
      --left-color: var(--sky);
      --right-color: var(--ok);
      --left-alpha: 0;   /* 0..1 */
      --right-alpha: 0;  /* 0..1 */
    }
    *{box-sizing:border-box;-webkit-tap-highlight-color:transparent}

    /* ===== レイアウト（スクロール抑制） ===== */
    html, body{height:100svh}
    body{margin:0;color:var(--ink);font-family:Inter,system-ui,-apple-system,"Segoe UI","Hiragino Sans","Noto Sans JP",sans-serif; overflow:hidden;
      background:
        radial-gradient(1100px 700px at 90% -10%, rgba(255,200,100,.35), transparent 60%),
        radial-gradient(900px 600px at -10% -10%, rgba(130,230,255,.35), transparent 60%),
        radial-gradient(900px 600px at 50% 120%, rgba(255,150,200,.35), transparent 60%),
        linear-gradient(180deg,#fffdf8,#fff7ef 40%, #fff3fa);
      background-attachment: fixed;
    }
    .wrap{height:100%;display:flex;flex-direction:column}
    header{position:sticky;top:0;z-index:30;background:rgba(255,255,255,.85);backdrop-filter:blur(10px);border-bottom:1px solid var(--line)}
    .nav{display:flex;align-items:center;gap:12px;max-width:720px;margin:auto;padding:10px 16px}
    .brand{display:flex;align-items:center;gap:10px;text-decoration:none;color:var(--ink)}
    .brand-mark{width:28px;height:28px;border-radius:8px;background:conic-gradient(from 200deg,var(--brand),var(--sky),var(--ok));box-shadow:0 0 0 3px rgba(0,0,0,.04) inset}
    .brand-title{font-weight:800;letter-spacing:.3px}
    .hint{margin-left:auto;font-size:12px;color:var(--muted)}

    main{flex:1;display:grid;place-items:center;padding:14px}
    .stage{width:min(720px,100%);height:calc(100% - 0px);display:flex;flex-direction:column;gap:12px}

    /* 画面切替（各画面は内部スクロール可） */
    .screen{display:none;min-height:0;flex:1;overflow:auto;-webkit-overflow-scrolling:touch}
    .screen.active{display:block}

    /* バブル背景 */
    .bubbles{position:fixed;inset:0;pointer-events:none;opacity:.35}
    .bubbles span{position:absolute;width:10px;height:10px;border-radius:50%;background:rgba(255,255,255,.85);box-shadow:0 0 0 1px rgba(0,0,0,.04) inset;animation:float 12s linear infinite}
    .bubbles span:nth-child(3n){width:6px;height:6px;animation-duration:10s}
    .bubbles span:nth-child(5n){width:14px;height:14px;animation-duration:14s}
    @keyframes float{from{transform:translateY(20vh)} to{transform:translateY(-120vh)}}

    /* 左右グラデフィードバック */
    .lr-gradient{position:absolute;inset:0;pointer-events:none;border-radius:var(--radius);overflow:hidden}
    .lr-gradient::before{content:"";position:absolute;inset:0;background:linear-gradient(90deg, color-mix(in srgb, var(--left-color) calc(var(--left-alpha)*60%), transparent), transparent 40%);}
    .lr-gradient::after{content:"";position:absolute;inset:0;background:linear-gradient(270deg, color-mix(in srgb, var(--right-color) calc(var(--right-alpha)*60%), transparent), transparent 40%);}

    /* カード */
    .stack{position:relative;flex:1;min-height:420px;touch-action:pan-x}
    .card{position:absolute;inset:0;background:linear-gradient(180deg,#fff,#f9f9ff);border:1px solid var(--line);border-radius:var(--radius);box-shadow:var(--shadow);padding:18px;display:flex;flex-direction:column;overflow:hidden}
    .card::after{content:"";position:absolute;inset:auto -20% -40%;height:60%;background:radial-gradient(800px 200px at 50% 0%,rgba(0,0,0,.04),transparent 60%);pointer-events:none}
    .qbadge{display:inline-flex;align-items:center;gap:8px;font-size:12px;color:var(--muted);border:1px solid var(--line);border-radius:999px;padding:6px 10px;background:#fff}
    .qtext{margin:14px 0 6px 0;font-size:22px;line-height:1.35;font-weight:800}
    .qsub{color:var(--muted);font-size:13px}

    .opts{margin-top:auto;display:grid;gap:12px}
    .opt{display:flex;align-items:center;gap:12px;border:1px solid var(--line);background:#fff;border-radius:14px;padding:12px 14px}
    .opt-left{background:color-mix(in srgb, var(--left-color) 6%, #fff)}
    .opt-right{background:color-mix(in srgb, var(--right-color) 6%, #fff)}
    .opt.active-left{background:color-mix(in srgb, var(--left-color) 16%, #fff); border-color:color-mix(in srgb, var(--left-color) 35%, var(--line))}
    .opt.active-right{background:color-mix(in srgb, var(--right-color) 16%, #fff); border-color:color-mix(in srgb, var(--right-color) 35%, var(--line))}

    .bullet{width:22px;height:22px;border-radius:50%;border:2px solid #d6d8e4}
    .opt span{font-size:15px}

    /* 方向チップ */
    .edges{position:absolute;inset:0;pointer-events:none;}
    .edge{position:absolute;top:12px;display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:999px;border:1px solid var(--line);background:#fff;font-size:12px;color:#4b5563;font-weight:700;opacity:.95}
    .edge.left{left:12px}
    .edge.right{right:12px}
    .edge .arrow{font-weight:900}

    /* SWIPEスタンプ */
    .ghost{position:absolute;inset:0;display:grid;place-items:center;pointer-events:none}
    .ghost span{font-size:40px;font-weight:900;letter-spacing:.08em;opacity:.08}

    .actions{display:flex;justify-content:center;gap:14px}
    .btn{appearance:none;border:none;border-radius:16px;padding:14px 18px;background:#fff;color:var(--ink);border:1px solid var(--line);font-weight:800}
    .btn.like{background:rgba(15,157,88,.08);border-color:rgba(15,157,88,.35)}
    .btn.pass{background:rgba(26,115,232,.08);border-color:rgba(26,115,232,.35)}
    .btn.cta{background:#111827;color:#fff;border-color:#111827}

    /* ===== Intro screens ===== */
    .hero{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:14px;text-align:center;padding:18px}
    .hero-mark{width:68px;height:68px;border-radius:20px;background:conic-gradient(from 200deg,var(--brand),var(--sky),var(--ok)); box-shadow:var(--shadow)}
    .hero h1{margin:6px 0 0 0;font-size:28px;line-height:1.25}
    .hero p{margin:0;color:#4b5563}

    .howto{display:grid;gap:10px;padding:14px}
    .howto .row{display:flex;align-items:center;gap:10px;border:1px dashed var(--line);background:#fff;border-radius:14px;padding:12px}
    .tag{display:inline-flex;align-items:center;gap:6px;border-radius:999px;padding:6px 10px;border:1px solid var(--line);background:#fff;font-size:12px}

    /* Result full screen */
    #screen-result{min-height:78svh}
    .result-hero{display:flex;flex-direction:column;gap:14px;padding:14px}
    .pill{display:inline-flex;align-items:center;gap:8px;border-radius:999px;border:1px solid var(--line);padding:8px 12px;background:#fff}
    .type-dot{width:10px;height:10px;border-radius:50%}
    .type-name{font-weight:800}
    .type-title{font-family:"Playfair Display",serif;font-size:32px;line-height:1.25;margin:4px 0}
    .type-desc{color:var(--muted)}
    .recs{display:grid;gap:12px;margin-top:4px}
    .wine{display:flex;gap:12px;border:1px solid var(--line);background:linear-gradient(180deg,#fff,#fbfbff);border-radius:14px;padding:12px}
    .wine img{width:64px;height:64px;object-fit:contain;border-radius:10px;background:#fff;border:1px solid var(--line)}
    .wine .wname{font-weight:800}
    .wine .wmeta{color:var(--muted);font-size:13px}
    .cta{margin-left:auto;display:flex;flex-direction:column;gap:8px}
    .cta a{display:inline-flex;justify-content:center;align-items:center;border-radius:12px;padding:10px 12px;border:1px solid var(--line);text-decoration:none;color:var(--ink)}
    .cta a.buy{border-color:transparent}

    /* Footer */
    footer{padding:10px 16px;border-top:1px solid var(--line);color:var(--muted);font-size:12px;text-align:center;background:rgba(255,255,255,.7)}

    /* Theme per type */
    .theme-BOLD{--accent:var(--BOLD)}
    .theme-FRESH{--accent:var(--FRESH)}
    .theme-AROMA{--accent:var(--AROMA)}
    .theme-SWEET{--accent:var(--SWEET)}
    .theme-SPARK{--accent:var(--SPARK)}
    .accent{color:var(--accent)}
    .btn.like,.pill,.wine .tag,.cta a.buy{background:color-mix(in srgb,var(--accent) 18%, transparent)}
    .cta a.buy{border:1px solid color-mix(in srgb,var(--accent) 40%, #000)}
    .qbadge{border-color:color-mix(in srgb,var(--accent) 35%, var(--line))}

    /* Loading (期待感) */
    #loading{position:fixed;inset:0;background:rgba(255,255,255,.9);backdrop-filter:blur(10px);display:none;align-items:center;justify-content:center;z-index:40}
    #loading.active{display:flex}
    .loader{display:flex;flex-direction:column;align-items:center;gap:12px}
    .dots{display:flex;gap:8px}
    .dot{width:10px;height:10px;border-radius:50%;background:var(--accent);animation:bounce 1s infinite ease-in-out}
    .dot:nth-child(2){animation-delay:.15s}
    .dot:nth-child(3){animation-delay:.30s}
    @keyframes bounce{0%,80%,100%{transform:translateY(0);opacity:.4}40%{transform:translateY(-10px);opacity:1}}
  </style>
</head>
<body>
  <div class="bubbles">
    <span style="left:10%; animation-delay:.2s"></span>
    <span style="left:25%; animation-delay:.8s"></span>
    <span style="left:40%; animation-delay:1.2s"></span>
    <span style="left:55%; animation-delay:.4s"></span>
    <span style="left:70%; animation-delay:1.6s"></span>
    <span style="left:85%; animation-delay:.6s"></span>
  </div>
  <div class="wrap">
    <header>
      <div class="nav">
        <a class="brand" href="#" aria-label="home"><span class="brand-mark"></span><span class="brand-title">Pairin<span style="opacity:.6">｜YORUGOS</span></span></a>
        <span class="hint">左にパス / 右にLIKE（スワイプまたはタップ）</span>
      </div>
    </header>

    <main>
      <div class="stage">
        <!-- Screen: Intro 1 (Title) -->
        <section id="screen-intro1" class="screen active">
          <div class="hero">
            <div class="hero-mark"></div>
            <h1>ワインで“あなた”にマッチング</h1>
            <p>10問に直感で答えるだけ。<br>フェスの一杯を、もっと好きに。</p>
            <button class="btn cta" id="go-intro2">はじめる</button>
          </div>
          <div class="howto">
            <div class="row"><span class="tag">左右スワイプ</span><span>左にスワイプ＝<b>パス</b>。右にスワイプ＝<b>LIKE</b>。</span></div>
            <div class="row"><span class="tag">タップでもOK</span><span>下のボタンでも同じ操作ができます。</span></div>
          </div>
        </section>

        <!-- Screen: Intro 2 (How-to / Demo) -->
        <section id="screen-intro2" class="screen">
          <div class="hero" style="padding-top:6px">
            <h1 style="margin-top:0">操作ガイド</h1>
            <p>カードを左右に動かすと、<b>背景が左右の色で光り</b>、<br>対応する選択肢が<b>強調</b>されます。</p>
            <button class="btn cta" id="go-quiz">質問へ進む</button>
          </div>
        </section>

        <!-- Screen: Quiz -->
        <section id="screen-quiz" class="screen" aria-live="polite">
          <div style="position:relative;height:100%">
            <div class="lr-gradient"></div>
            <div id="stack" class="stack"></div>
          </div>
          <div class="actions">
            <button class="btn pass" id="btn-pass" aria-label="PASS">← パス（左）</button>
            <button class="btn like" id="btn-like" aria-label="LIKE">LIKE（右） →</button>
          </div>
        </section>

        <!-- Screen: Result (full) -->
        <section id="screen-result" class="screen" aria-live="polite"></section>
      </div>
    </main>

    <footer>
      © YORUGOS. GitHub Pages で動作。質問・ワインは /data 配下の JSON / CSV を差し替えるだけ。
    </footer>
  </div>

  <!-- Loading: 期待感を演出 -->
  <div id="loading" role="status" aria-live="assertive">
    <div class="loader">
      <div class="dots"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>
      <div id="loading-text" style="font-weight:800">マッチング中…</div>
      <div style="font-size:12px;color:var(--muted)" id="loading-sub">味わいマトリクスを解析しています</div>
    </div>
  </div>

<script>
/********************
 * Data Loading Layer
 ********************/
const DataLoader = {
  async loadQuestions(){
    try{ const res = await fetch('./data/questions.json?ts=' + Date.now()); if(!res.ok) throw 0; return await res.json(); }
    catch{ return DefaultData.questions; }
  },
  async loadWines(){
    try{ const csv = await fetch('./data/wines.csv?ts=' + Date.now()); if(csv.ok){ const text = await csv.text(); return CSV.parse(text);} throw 0; }
    catch{
      try{ const res = await fetch('./data/wines.json?ts=' + Date.now()); if(!res.ok) throw 0; return await res.json(); }
      catch{ return DefaultData.wines; }
    }
  }
};

/********************
 * Lightweight CSV
 ********************/
const CSV = {
  parse(str){
    const [head, ...rows] = str.trim().split(/\r?\n/);
    const keys = head.split(',').map(s=>s.trim());
    return rows.map((line)=>{
      const vals = line.split(',').map(s=>s.trim());
      const o={}; keys.forEach((k,i)=>o[k]=vals[i]??'');
      if(o.price) o.price = Number(o.price);
      if(o.tags) o.tags = o.tags.split('|').map(t=>t.trim());
      return o;
    });
  }
};


/********************
 * Domain Models (OOP)
 ********************/
class Question{ constructor({id,text,left,right,weights,subtitle}){ this.id=id; this.text=text; this.left=left; this.right=right; this.weights=weights; this.subtitle=subtitle||''; } }
class QuizEngine{
  constructor(questions){ this.questions=questions.map(q=>new Question(q)); this.index=0; this.scores={BOLD:0,FRESH:0,AROMA:0,SWEET:0,SPARK:0}; this.answers=[]; }
  current(){ return this.questions[this.index]; }
  finished(){ return this.index>=this.questions.length; }
  answer(choice){ const q=this.current(); if(!q) return; const w=q.weights?.[choice]||{}; for(const k in w){ this.scores[k]=(this.scores[k]||0)+w[k]; } this.answers.push({id:q.id,choice}); this.index++; }
  topType(){ const entries=Object.entries(this.scores); entries.sort((a,b)=>b[1]-a[1]); return entries[0][0]; }
}
class WineRepo{ constructor(wines){ this.wines=wines; } byType(type){ return this.wines.filter(w=> (w.type||'').toUpperCase()===type ); } }
class Matcher{ constructor(repo){ this.repo=repo; } recommend(type,limit=6){ const list=this.repo.byType(type); return list.slice(0,limit); } }

/********************
 * Screen Controller
 ********************/
const Screens = {
  intro1: document.getElementById('screen-intro1'),
  intro2: document.getElementById('screen-intro2'),
  quiz: document.getElementById('screen-quiz'),
  result: document.getElementById('screen-result'),
  loading: document.getElementById('loading'),
  show(name){
    for(const s of [this.intro1,this.intro2,this.quiz,this.result]) s.classList.remove('active');
    if(name==='intro1') this.intro1.classList.add('active');
    if(name==='intro2') this.intro2.classList.add('active');
    if(name==='quiz') this.quiz.classList.add('active');
    if(name==='result') this.result.classList.add('active');
  },
  async showLoadingThen(fn){ this.loading.classList.add('active'); const tips=[ '味わいマトリクスを解析しています', 'あなたの好みをペアリング中…', 'ワインの旅支度をしています' ];
    const sub=document.getElementById('loading-sub'); let i=0; const t=setInterval(()=>{sub.textContent=tips[i++%tips.length]}, 900);
    await new Promise(r=>setTimeout(r, 1200));
    clearInterval(t); this.loading.classList.remove('active'); fn(); }
};

/********************
 * UI / Controller
 ********************/
const UI = {
  stackEl: document.getElementById('stack'),
  root: document.documentElement,
  lr: document.querySelector('.lr-gradient'),
  mountStack(quiz){
    this.stackEl.innerHTML='';
    for(let i=quiz.index;i<quiz.questions.length;i++){
      const q=quiz.questions[i];
      const el=UI.createCard(q,i+1,quiz.questions.length);
      el.style.zIndex = String(100 + i);
      this.stackEl.appendChild(el);
    }
    UI.attachTopCardGesture(quiz);
  },
  createCard(q, idx, total){
    const el=document.createElement('div'); el.className='card'; el.dataset.qid=q.id; el.innerHTML=`
      <div class="qbadge">Q${idx}/${total}・迷ったら感覚でOK</div>
      <div class="qtext">${q.text}</div>
      ${q.subtitle?`<div class=\"qsub\">${q.subtitle}</div>`:''}
      <div class="edges">
        <div class="edge left"><span class="arrow">←</span> パス</div>
        <div class="edge right">LIKE <span class="arrow">→</span></div>
      </div>
      <div class="ghost"><span>左右にスワイプ</span></div>
      <div class="opts">
        <div class="opt opt-left"><div class="bullet"></div><span>${q.left}</span></div>
        <div class="opt opt-right"><div class="bullet"></div><span>${q.right}</span></div>
      </div>`; return el; },
  setGradient(dx){ // - for left, + for right
    const a = Math.min(Math.abs(dx)/180, 1);
    document.documentElement.style.setProperty('--left-alpha', dx<0 ? a : 0);
    document.documentElement.style.setProperty('--right-alpha', dx>0 ? a : 0);
  },
  attachTopCardGesture(quiz){ const top=this.stackEl.querySelector('.card:last-child'); if(!top) return; const mc=new Hammer(top); mc.get('pan').set({direction:Hammer.DIRECTION_HORIZONTAL, threshold:8}); let dx=0; let decided=null; const ghost=top.querySelector('.ghost span'); const optL=top.querySelector('.opt-left'); const optR=top.querySelector('.opt-right');
    const onTransform=()=>{ const rot=dx/22; const ty=Math.abs(dx)/10*-1; const alpha=Math.min(Math.abs(dx)/160,1); top.style.transform=`translate(${dx}px, ${ty}px) rotate(${rot}deg)`; top.style.opacity=String(1-alpha*0.06); ghost.textContent= dx>0? 'LIKE →' : '← PASS'; ghost.style.opacity=.08+alpha*.28; ghost.style.color= dx>0? 'var(--ok)':'var(--sky)'; UI.setGradient(dx); optL.classList.toggle('active-left', dx<0 && Math.abs(dx)>30); optR.classList.toggle('active-right', dx>0 && Math.abs(dx)>30); };
    mc.on('pan', ev=>{ dx=ev.deltaX; onTransform(); });
    const decide=(dir)=>{ top.style.transition='.25s'; top.style.transform=`translate(${dir==='right'? 500:-500}px, -20px) rotate(${dir==='right'? 14:-14}deg)`; setTimeout(()=>{ top.remove(); UI.setGradient(0); quiz.answer(dir==='right'? 'right':'left'); if(!quiz.finished()){ UI.attachTopCardGesture(quiz);} else { Screens.showLoadingThen(()=>UI.showResult(quiz)); } }, 180); };
    mc.on('panend', ()=>{ if(Math.abs(dx)>120){ decided = dx>0? 'right' : 'left'; } if(!decided){ top.style.transition='.2s'; top.style.transform='translate(0,0)'; top.style.opacity='1'; UI.setGradient(0); optL.classList.remove('active-left'); optR.classList.remove('active-right'); return setTimeout(()=>top.style.transition='',200); } decide(decided); });
  },
  linkButtons(quiz){ const like=()=>{ const top=this.stackEl.querySelector('.card:last-child'); if(!top) return; top.style.transition='.25s'; top.style.transform='translate(500px,-20px) rotate(14deg)'; setTimeout(()=>{ top.remove(); quiz.answer('right'); if(!quiz.finished()) UI.attachTopCardGesture(quiz); else Screens.showLoadingThen(()=>UI.showResult(quiz)); },180); };
    const pass=()=>{ const top=this.stackEl.querySelector('.card:last-child'); if(!top) return; top.style.transition='.25s'; top.style.transform='translate(-500px,-20px) rotate(-14deg)'; setTimeout(()=>{ top.remove(); quiz.answer('left'); if(!quiz.finished()) UI.attachTopCardGesture(quiz); else Screens.showLoadingThen(()=>UI.showResult(quiz)); },180); };
    document.getElementById('btn-like').onclick=like; document.getElementById('btn-pass').onclick=pass; },
  setThemeByType(type){ this.root.classList.remove('theme-BOLD','theme-FRESH','theme-AROMA','theme-SWEET','theme-SPARK'); const map={BOLD:'theme-BOLD',FRESH:'theme-FRESH',AROMA:'theme-AROMA',SWEET:'theme-SWEET',SPARK:'theme-SPARK'}; this.root.classList.add(map[type]||''); },
  showResult(quiz){ const type=quiz.topType(); UI.setThemeByType(type); const copy=DefaultData.typeCopy[type]||{title:type,desc:''}; const wines=app.matcher.recommend(type,6);
    const h=[]; h.push(`<div class=\"pill\"><span class=\"type-dot\" style=\"background:var(--accent)\"></span><span class=\"type-name\">TYPE: <span class='accent'>${type}</span></span></div>`);
    h.push(`<div class=\"type-title\">マッチングしました！ ${copy.title}</div>`);
    h.push(`<div class=\"type-desc\">${copy.desc}</div>`);
    if(!wines.length){ h.push(`<p style='margin-top:6px'>該当のワインがありませんでした。<br>データの <code>type</code> を <code>${type}</code> に設定した銘柄を追加してください。</p>`); }
    else{ h.push(`<div class='recs'>${wines.map(w=>UI.renderWine(w)).join('')}</div>`); }
    Screens.result.innerHTML = `<div class='result-hero'>${h.join('')}</div>`;
    Screens.show('result');
  },
  renderWine(w){ const tag=w.type||'WINE'; const img=w.image||'https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/wine.svg'; const price=w.price? `¥${w.price.toLocaleString()}`:''; const shop=w.link? `<a class=\"buy\" href=\"${w.link}\" target=\"_blank\" rel=\"noopener\">購入ページ</a>`:''; const detail=w.detail? `<a href=\"${w.detail}\" target=\"_blank\" rel=\"noopener\">詳細</a>`:'';
    return `<div class=\"wine\"><img alt=\"${w.name}\" src=\"${img}\" /><div><div class=\"wname\">${w.name}</div><div class=\"wmeta\">${tag}・${w.region||''} ${price}</div><div class=\"wmeta\">${w.notes||''}</div></div><div class=\"cta\">${shop}${detail}</div></div>`; }
};

/********************
 * Default Sample Data (used if /data is absent)
 ********************/
const DefaultData={
  typeCopy:{
    BOLD:{ title:'コク深く、旨みリッチ', desc:'肉料理や濃い味の前菜に。余韻が長く、飲みごたえ重視のあなたへ。' },
    FRESH:{ title:'爽やか＆ジューシー', desc:'柑橘や青リンゴのアロマ。和食や軽いおつまみにも◎。' },
    AROMA:{ title:'香り華やか', desc:'白い花やハーブ、トロピカルな香り。香りで選びたい人に。' },
    SWEET:{ title:'やさしい甘口', desc:'デザートやスパイス料理に。心地よい甘みで飲みやすい。' },
    SPARK:{ title:'きらめく泡', desc:'乾杯や前菜に万能。ライト＆楽しい時間を演出。' }
  },
  questions:[
    {id:'q1',text:'初めての一杯。どっちに惹かれる？',left:'スッキリ爽快',right:'じんわり濃厚',weights:{left:{FRESH:2,SPARK:1},right:{BOLD:2,AROMA:1}}},
    {id:'q2',text:'香りの印象は？',left:'控えめで清潔感',right:'華やかで印象的',weights:{left:{FRESH:2},right:{AROMA:2}}},
    {id:'q3',text:'甘みはどのくらい？',left:'ほぼドライ',right:'ちょい甘～甘口',weights:{left:{FRESH:1,BOLD:1},right:{SWEET:2}}},
    {id:'q4',text:'飲むシーンは？',left:'食事と合わせたい',right:'乾杯やおやつタイム',weights:{left:{BOLD:1,FRESH:1},right:{SPARK:2,SWEET:1}}},
    {id:'q5',text:'温度は？',left:'キリッと冷やす',right:'少し温度高め',weights:{left:{FRESH:1,SPARK:1},right:{BOLD:2}}},
    {id:'q6',text:'余韻の長さは？',left:'短めでリズミカル',right:'長くて複層的',weights:{left:{FRESH:1,SPARK:1},right:{BOLD:2,AROMA:1}}},
    {id:'q7',text:'好きなペアリング',left:'お寿司／塩焼き',right:'濃いソース／肉',weights:{left:{FRESH:2,SPARK:1},right:{BOLD:2}}},
    {id:'q8',text:'ラベルはどっち？',left:'ミニマル',right:'装飾的',weights:{left:{FRESH:1,SPARK:1},right:{AROMA:1,SWEET:1}}},
    {id:'q9',text:'気分は？',left:'軽やかに進めたい',right:'腰を据えて楽しむ',weights:{left:{SPARK:2,FRESH:1},right:{BOLD:2}}},
    {id:'q10',text:'ワインの冒険心',left:'馴染み重視',right:'個性ウェルカム',weights:{left:{FRESH:1,SWEET:1},right:{AROMA:2,BOLD:1}}}
  ],
  wines:[
    {name:'CAIR カイール・ブリュット N/V',type:'SPARK',region:'Rhodes, Greece',price:3500,notes:'爽やかな泡。柑橘と白い花の香り。',link:'https://oinos.example/item/cair-brut',image:''},
    {name:'モスコフィレロ ドメーヌ',type:'AROMA',region:'Peloponnese, Greece',price:4200,notes:'ジャスミンとハーブ。華やかな辛口白。',link:'https://oinos.example/item/moscofilero'},
    {name:'サヴァティアノ ナチュール',type:'FRESH',region:'Attica, Greece',price:3100,notes:'青リンゴとレモン。すっきりとした酸。',link:'https://oinos.example/item/savatiano'},
    {name:'クシノマヴロ リザーヴ',type:'BOLD',region:'Naoussa, Greece',price:5800,notes:'チェリーとスパイス。余韻長く複層。',link:'https://oinos.example/item/xinomavro'},
    {name:'マヴロダフニ デザート',type:'SWEET',region:'Patras, Greece',price:3900,notes:'干し葡萄とカカオ。デザートに最適。',link:'https://oinos.example/item/mavrodaphne'},
    {name:'アシルティコ サントリーニ',type:'FRESH',region:'Santorini, Greece',price:6500,notes:'火山性ミネラル、切れ味鋭い。',link:'https://oinos.example/item/assyrtiko'}
  ]
};

/********************
 * App Bootstrap with DOM ready
 ********************/
const app={ quiz:null, repo:null, matcher:null,
  async start(){ try{ const [questions,wines]=await Promise.all([ DataLoader.loadQuestions(), DataLoader.loadWines() ]);
      this.quiz=new QuizEngine(questions); this.repo=new WineRepo(wines); this.matcher=new Matcher(this.repo);
      UI.linkButtons(this.quiz); UI.mountStack(this.quiz);
      // Intro buttons
      document.getElementById('go-intro2').addEventListener('click',()=>Screens.show('intro2'));
      document.getElementById('go-quiz').addEventListener('click',()=>Screens.show('quiz'));
      Screens.show('intro1');
    }catch(err){ console.error(err); document.getElementById('stack').innerHTML = `<div style='padding:16px;border:1px dashed var(--line);border-radius:12px;background:#fff'>スクリプトエラーが発生しました。</div>`; }
  }
};

window.addEventListener('DOMContentLoaded', ()=> app.start());
</script>
</body>
</html>
